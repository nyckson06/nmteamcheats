<!doctype html>
<html lang=pt-BR>
<head>
<meta charset=utf-8>
<meta content="width=device-width,initial-scale=1" name=viewport>
<title>NmTeam - Menu</title>
<script type=module>import{initializeApp}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,updatePassword,signOut}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";import{getDatabase,ref,set,onValue,update,remove,get}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";const firebaseConfig={apiKey:"AIzaSyCzj4sP6TvIg1kFAAZ3hrgy9KqAWkDCnx4",authDomain:"skotvidero.firebaseapp.com",databaseURL:"https://skotvidero-default-rtdb.firebaseio.com",projectId:"skotvidero",storageBucket:"skotvidero.appspot.com",messagingSenderId:"797827317952",appId:"1:797827317952:android:83ec9bb10d5a283826ed25"},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getDatabase(app);let currentUser=null,currentUserCargo="";function isDev(){return"dev"===currentUserCargo.toLowerCase()}function carregarProdutos(){const e=document.getElementById("produtosContainer");onValue(ref(db,"produtos"),(t=>{e.innerHTML="",t.forEach((t=>{const o=t.key,a=t.val(),n=document.createElement("div");n.className="product"+("Dev"===a.autorCargo?" dev-produto":""),n.innerHTML=`\n            <img src="${a.imagem}" alt="${a.nome}">\n            <h2>${a.nome} ${a.entregaAutomatica?'<span style="color:cyan;font-size:11px">#Entrega Automática</span>':""}</h2>\n            <p>R$ ${a.preco}</p>\n            <p><strong>Vendedor:</strong> ${a.autor||"Desconhecido"}</p>\n            <button class="buy-btn" onclick="window.open('${a.whatsapp}', '${a.nome}')">Comprar</button>\n            \n            \n            \n            ${isDev()||["admin","Admin"].includes(currentUserCargo)&&a.autor===currentUser.email?`<button onclick="editarProduto('${o}')">Editar</button>\n                   <button onclick="removerProduto('${o}')">Remover</button>`:""}\n          `,e.appendChild(n)}))}))}function carregarChatsRecebidos(){const e=document.getElementById("helperContainer");e.innerHTML="<h2>Mensagens Recebidas</h2>",get(ref(db,"chats")).then((t=>{t.forEach((t=>{t.key;const o=t.val();if(o.participantes&&o.participantes[currentUser.uid]){const t=Object.keys(o.participantes).find((e=>e!==currentUser.uid));get(ref(db,"users/"+t)).then((o=>{const a=o.val(),n=document.createElement("div");n.className="helper-card",n.innerHTML=`\n            <strong>${a?.nome||t}</strong><br/>\n            <button onclick="abrirChatComDev('${t}', '${a?.nome||t}')" style="color:cyan;">Abrir Conversa</button>\n          `,e.appendChild(n)}))}}))}))}function carregarDevs(){const e=document.getElementById("helperContainer");e.innerHTML="<h2>Desenvolvedores</h2>",get(ref(db,"users")).then((t=>{t.forEach((t=>{const o=t.val();if("dev"===o.cargo?.toLowerCase()){const a=document.createElement("div");a.className="helper-card",a.innerHTML=`\n          <strong>${o.nome}</strong><br/>\n          <button onclick="abrirChatComDev('${t.key}', '${o.nome}')" style="color:cyan;">Chat</button>\n        `,e.appendChild(a)}}))}))}function gerarPoputFicticio(){get(ref(db,"produtos")).then((e=>{const t=[];if(e.forEach((e=>{const o=e.val();t.push(o.nome)})),t.length>0){const e=function(){const e=["João","Resende","Pedro","Lucas","Biel","Carlos","Julia","Gabriel","Nanda","Rafael","Camila","Biel","Lucas"],t=["Silva","Souza","Oliveira","Santos","Lima","Costa","FF","R.","Rocha","M.","S.","B."];return e[Math.floor(Math.random()*e.length)]+" "+t[Math.floor(Math.random()*t.length)]}(),o=t[Math.floor(Math.random()*t.length)],a=new Date,n=Math.floor(60*Math.random());a.setMinutes(a.getMinutes()-n);a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const r=document.createElement("div");r.className="popup",r.textContent=`${e} comprou ${o}`,document.getElementById("popup-container").appendChild(r),setTimeout((()=>r.remove()),8e3)}}))}function carregarFeedbacks(){const e=document.getElementById("feedbackList");onValue(ref(db,"feedbacks"),(t=>{e.innerHTML="",t.forEach((t=>{const o=t.val(),a=document.createElement("div");if(a.className="comentario-dev",a.innerHTML=`<strong>${o.nome}</strong> [${o.cargo}]<br>${o.texto}<br><small>${o.data}</small>`,currentUser){const e=["admin","Admin"].includes(currentUserCargo),n="dev"===currentUserCargo.toLowerCase(),r=(o.cargo||"").toLowerCase(),s=n;if(n||e&&("usuário"===r||"cliente"===r)){const e=document.createElement("button");e.textContent="Remover",e.onclick=async()=>{await remove(ref(db,"feedbacks/"+t.key))},a.appendChild(e)}if(s&&o.uid){const e=document.createElement("button");e.textContent="Banir",e.onclick=async()=>{await update(ref(db,"users/"+o.uid),{banido:!0}),alert("Usuário banido.")},a.appendChild(e)}}e.appendChild(a)}))}))}window.register=async()=>{const e=document.getElementById("registerEmail").value,t=document.getElementById("registerPassword").value,o=document.getElementById("registerUsername").value;if(!e||!t||!o)return alert("Preencha todos os campos.");try{const a=(await createUserWithEmailAndPassword(auth,e,t)).user,n=await fetch("https://api.ipify.org").then((e=>e.text()));await set(ref(db,"users/"+a.uid),{email:e,nome:o,cargo:"usuário",banido:!1,id_user:t,ip:n}),alert("Cadastro realizado com sucesso!"),showLogin()}catch(e){alert("Erro no cadastro: "+e.message)}},window.login=async()=>{const e=document.getElementById("loginEmail").value,t=document.getElementById("loginPassword").value;try{let o=e;if(!e.includes("@")){(await get(ref(db,"users"))).forEach((t=>{const a=t.val();a.nome===e&&(o=a.email)}))}const a=await signInWithEmailAndPassword(auth,o,t);currentUser=a.user;const n=(await get(ref(db,"users/"+currentUser.uid))).val();if(n.banido)return alert("Você está banido."),await signOut(auth),location.reload();if(currentUserCargo=n.cargo||"usuário",document.getElementById("auth").style.display="none",document.getElementById("shop").style.display="block",document.getElementById("perfilEmail").value=currentUser.email,document.getElementById("perfilLink").value=n.link||"",["admin","Admin","DEV","dev","Dev"].includes(currentUserCargo)){const e=document.createElement("button");e.innerHTML="➕",e.className="floating-add",e.onclick=adicionarProduto,document.querySelector("header").appendChild(e)}carregarProdutos()}catch(e){alert("Erro no login: "+e.message)}},window.logout=async()=>{await signOut(auth),location.reload()},window.showRegister=()=>{document.getElementById("loginBox").style.display="none",document.getElementById("registerBox").style.display="block"},window.showLogin=()=>{document.getElementById("registerBox").style.display="none",document.getElementById("loginBox").style.display="block"},window.togglePerfil=()=>{document.getElementById("perfil").style.display="block",document.getElementById("shop").style.display="none"},window.salvarPerfil=async()=>{const e=document.getElementById("perfilSenha").value,t=document.getElementById("perfilNome").value;t&&await update(ref(db,"users/"+currentUser.uid),{nome:t});const o=document.getElementById("perfilLink").value;o&&await update(ref(db,"users/"+currentUser.uid),{link:o}),e&&await updatePassword(currentUser,e),alert("Perfil atualizado!")},onValue(ref(db,"poputs"),(e=>{e.forEach((e=>{const t=e.val();t.ativo&&mostrarPoput(t.usuario,t.produto)}))})),window.abrirChatComDev=async(e,t)=>{const o=[currentUser.uid,e].sort().join("-"),a=ref(db,`chats/${o}`);(await get(a)).exists()||await set(ref(db,`chats/${o}/participantes`),{[currentUser.uid]:!0,[e]:!0}),mostrarChat(o,t)},window.mostrarChat=(e,t)=>{let o=document.getElementById("chatContainer");o||(o=document.createElement("div"),o.id="chatContainer",o.style.background="#1e1e1e",o.style.padding="20px",o.style.margin="20px",o.style.border="1px solid #444",o.style.borderRadius="10px",o.style.color="white",document.body.appendChild(o)),o.innerHTML=`<h3>Chat com ${t}</h3>\n        <div id="mensagens"></div>\n        <textarea id="mensagemInput" placeholder="Digite sua mensagem..."></textarea>\n        <button onclick="enviarMensagem('${e}')">Enviar</button>\n        <button onclick="fecharChat()">Fechar</button>`,o.style.display="block";const a=document.getElementById("mensagens");onValue(ref(db,`chats/${e}/mensagens`),(e=>{a.innerHTML="",e.forEach((e=>{const t=e.val();a.innerHTML+=`<p><strong>${t.autor}:</strong> ${t.texto}</p>`}))}))},window.enviarMensagem=e=>{const t=document.getElementById("mensagemInput").value;if(!t)return;const o=Date.now();set(ref(db,`chats/${e}/mensagens/${o}`),{autor:currentUser.email,uid:currentUser.uid,texto:t}),document.getElementById("mensagemInput").value=""},window.fecharChat=()=>{const e=document.getElementById("chatContainer");e&&(e.style.display="none")},setInterval(gerarPoputFicticio,1e4),window.enviarFeedback=async()=>{if(!currentUser)return alert("Você precisa estar logado para enviar feedback."),document.getElementById("auth").style.display="flex",void(document.getElementById("shop").style.display="none");const e=document.getElementById("novoFeedback").value;if(!e)return alert("Digite algo.");const t=Date.now().toString(),o=(await get(ref(db,"users/"+currentUser.uid))).val();await set(ref(db,"feedbacks/"+t),{texto:e,nome:o.nome||"Desconhecido",cargo:o.cargo||"usuário",data:(new Date).toLocaleString()}),document.getElementById("novoFeedback").value=""};const oldMostrarAba=window.mostrarAba;window.mostrarAba=e=>{if(!currentUser&&("helper"===e||"feedbacks"===e))return alert("Você precisa estar logado para acessar esta área."),document.getElementById("auth").style.display="flex",void(document.getElementById("shop").style.display="none");const t=document.getElementById("produtosContainer"),o=document.getElementById("helperContainer"),a=document.getElementById("feedbackContainer");document.querySelectorAll(".tabs button").forEach((e=>e.classList.remove("active"))),"compras"===e?(t.style.display="grid",o.style.display="none",a.style.display="none",document.getElementById("comprasTab").classList.add("active")):"helper"===e?(t.style.display="none",o.style.display="block",a.style.display="none",document.querySelector(".tabs button:nth-child(2)").classList.add("active"),"dev"===currentUserCargo.toLowerCase()?carregarChatsRecebidos():carregarDevs()):"feedbacks"===e&&(t.style.display="none",o.style.display="none",a.style.display="block",document.getElementById("feedbacksTab").classList.add("active"),carregarFeedbacks())},document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("shop").style.display="block",carregarProdutos()})),window.adicionarProduto=async()=>{const e=prompt("Nome do produto:"),t=prompt("Preço:"),o=prompt("URL da imagem:"),a=prompt("Link do WhatsApp (ex: https://wa.me/55...)"),n=confirm("Este produto é com entrega automática?");if(!(e&&t&&o&&a))return alert("Todos os campos são obrigatórios.");const r=(await get(ref(db,"users/"+currentUser.uid))).val(),s=r.nome||r.email,i=r.cargo||"usuário",d=Date.now();await set(ref(db,"produtos/"+d),{nome:e,preco:t,imagem:o,whatsapp:a,autor:s,autorCargo:i,entregaAutomatica:n}),await fetch("https://seu-replit-url.repl.co/notificar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nome:e,preco:t})}),alert("Produto adicionado!")},window.editarProduto=async e=>{const t=(await get(ref(db,"produtos/"+e))).val(),o=prompt("Novo nome do produto:",t.nome),a=prompt("Novo preço:",t.preco),n=prompt("Nova URL da imagem:",t.imagem),r=prompt("Novo link de compra/contato:",t.whatsapp),s=confirm("Produto com entrega automática?");if(!(o&&a&&n&&r))return alert("Preencha tudo!");await set(ref(db,"produtos/"+e),{nome:o,preco:a,imagem:n,whatsapp:r,autor:t.autor||"Desconhecido",autorCargo:t.autorCargo||"usuário",entregaAutomatica:s}),alert("Produto atualizado!")},window.removerProduto=async e=>{confirm("Tem certeza que deseja remover este produto?")&&(await remove(ref(db,"produtos/"+e)),alert("Produto removido."))},window.iniciarChatCom=async(e,t)=>{if(!currentUser)return alert("Você precisa estar logado para iniciar um chat com um Dev."),document.getElementById("auth").style.display="flex",void(document.getElementById("shop").style.display="none");const o=e+"_"+currentUser.uid,a=ref(db,"chats/"+o);(await get(a)).exists()||await set(a,{idUsuario:currentUser.uid,nomeUsuario:currentUserNome||"Desconhecido",idDev:e,nomeDev:t,mensagens:[],iniciadoEm:(new Date).toISOString()}),localStorage.setItem("chatCom",e),mostrarChatCom(e,t)}</script>
<style>body{background:#121212;color:#fff;font-family:Arial;margin:0;padding:0}header{background-color:red;color:#fff;padding:20px;text-align:center;font-size:24px;font-weight:700}.container{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;justify-items:center;padding:20px;max-width:600px;margin:0 auto}.product{background:#1e1e1e;border:2px solid red;border-radius:10px;padding:10px;width:100%;max-width:250px;text-align:center;box-sizing:border-box}.product img{max-width:100%;border-radius:8px}.product h2{font-size:20px;margin:10px 0;color:#ff4d4d}.product p{color:#ccc}.buy-btn{background:red;color:#fff;border:none;padding:10px;border-radius:5px;margin-top:10px;cursor:pointer}.auth-container{display:flex;justify-content:center;align-items:center;height:100vh}.auth-box{background:#1e1e1e;padding:30px;border-radius:10px;border:2px solid red;width:300px;text-align:center}.auth-box button,.auth-box input{width:90%;padding:10px;margin:10px 0;border-radius:5px;border:none}.auth-box button{background:red;color:#fff;cursor:pointer}.auth-box a{color:#ff4d4d;cursor:pointer;display:block;margin-top:10px}textarea{width:100%;margin-top:10px;padding:8px;border-radius:5px}.comentarios{text-align:left;margin-top:10px;font-size:14px}.popup{background:red;color:#fff;padding:10px;margin:10px;border-radius:8px;animation:fadeout 1s ease 4s forwards}#popup-container{position:fixed;bottom:10px;left:10px;z-index:9999}@keyframes fadeout{to{opacity:0;transform:translateX(-100%)}}.comentario-dev{border-left:4px solid #0ff;padding-left:6px;background-color:#1a1a1a;font-weight:700;color:#0ff}.product.dev-produto{border-color:#0ff;box-shadow:0 0 10px #00ffff88}header{background-color:red;color:#fff;padding:8px 10px;display:flex;align-items:center;justify-content:space-between;font-size:16px;font-weight:700}header button{margin-left:8px;padding:5px 10px;border-radius:5px;border:none}header button#perfilBtn{background:0 0;color:#fff;font-size:18px}header button#logoutBtn{background:red;color:#fff;box-shadow:0 0 8px #fff}.tabs{display:flex;justify-content:center;background:#1a1a1a;padding:5px;gap:10px}.tabs button{background:#333;border:none;padding:8px 12px;color:#fff;cursor:pointer;border-radius:5px}.tabs button.active{background:red}#helperContainer{display:none;padding:15px}.helper-card{background:#1e1e1e;border:1px solid #0ff;border-radius:8px;padding:10px;margin-bottom:10px}.floating-add{position:fixed;bottom:20px;right:20px;background:red;color:#fff;border:none;border-radius:50%;width:50px;height:50px;font-size:28px;line-height:50px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,.3);cursor:pointer;z-index:1000}.copyright-footer{position:fixed;bottom:0;width:100%;text-align:center;padding:10px 0;background:#1a1a1a;color:#aaa;font-size:14px;z-index:999}.container{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;padding:10px;justify-items:center;max-width:100%}.product{background:#1e1e1e;border:2px solid red;border-radius:8px;padding:8px;width:160px;box-sizing:border-box;text-align:center}.product img{max-width:100%;height:auto;border-radius:6px}.product h2{font-size:14px;margin:5px 0;color:#ff4d4d}.product p{font-size:12px;margin:2px 0;color:#ccc}.product button{font-size:12px;padding:6px 10px;margin-top:4px}.popup{background:rgba(0,0,0,.85);color:#fff;padding:5px 10px;border-radius:6px;margin-top:10px;font-size:12px;max-width:230px;animation:aparecer .5s ease}</style>
</head>
<body>
<div class=auth-container id=auth style=display:none>
<div class=auth-box id=loginBox>
<h2>Login</h2>
<input id=loginEmail placeholder="Email ou Nome de usuário" required>
<input id=loginPassword placeholder=Senha required type=password>
<button onclick=login()>Entrar</button>
<a onclick=showRegister()>Não tem conta? Cadastre-se</a>
</div>
<div class=auth-box id=registerBox style=display:none>
<h2>Cadastro</h2>
<input id=registerUsername placeholder="Nome de usuário" required>
<input id=registerEmail placeholder=Email required type=email>
<input id=registerPassword placeholder=Senha required type=password>
<button onclick=register()>Cadastrar</button>
<a onclick=showLogin()>Já tem conta? Entrar</a>
</div>
</div>
<div id=shop style=display:block>
<header>
<span>NmTeam - Menu</span>
<div>
<button id=perfilBtn onclick=togglePerfil()>⚙️</button>
</div>
</header>
<div class=tabs>
<button class=active id=comprasTab onclick='mostrarAba("compras")'>Lojinha</button>
<button onclick='mostrarAba("helper")'>Suport</button>
<button id=feedbacksTab onclick='mostrarAba("feedbacks")'>Feedbacks</button></div>
<div class=container id=produtosContainer>Carregando produtos...</div>
<div id=helperContainer></div>
<div id=feedbackContainer style=display:none;padding:15px>
<h2>Feedbacks da Comunidade</h2>
<textarea id=novoFeedback placeholder="Escreva seu feedback..."></textarea>
<button onclick=enviarFeedback()>Enviar</button>
<div id=feedbackList></div>
</div>
</div>
<div class=auth-box id=perfil style="display:none;margin:20px auto">
<h2>Perfil</h2>
<input id=perfilNome placeholder="Novo nome de usuário">
<input id=perfilSenha placeholder="Nova senha" type=password>
<input disabled id=perfilEmail type=email>
<input id=perfilLink placeholder="Link de contato (usar para publicar um produto)" type=url>
<button onclick=salvarPerfil()>Salvar alterações</button>
<button onclick="() =&gt; { document.getElementById('perfil').style.display='none'; document.getElementById('shop').style.display='block'; }">Voltar</button>
</div>
<div id=popup-container></div>
<footer class=copyright-footer>© 2025 NmTeam. Todos os direitos reservados.</footer>
</body>
</html>
