<!doctype html>
<html lang=pt-BR>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>NmTeam - Menu</title>
<script type=module>import{initializeApp}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,updatePassword,signOut}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";import{getDatabase,ref,set,onValue,update,remove,get}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";const firebaseConfig={apiKey:"AIzaSyCzj4sP6TvIg1kFAAZ3hrgy9KqAWkDCnx4",authDomain:"skotvidero.firebaseapp.com",databaseURL:"https://skotvidero-default-rtdb.firebaseio.com",projectId:"skotvidero",storageBucket:"skotvidero.appspot.com",messagingSenderId:"797827317952",appId:"1:797827317952:android:83ec9bb10d5a283826ed25"},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getDatabase(app);let currentUser=null,currentUserCargo="";function carregarProdutos(){const e=document.getElementById("produtosContainer");onValue(ref(db,"produtos"),(o=>{e.innerHTML="",o.forEach((o=>{const t=o.key,r=o.val(),a=document.createElement("div");a.className="product",a.innerHTML=`\n            <img src="${r.imagem}" alt="${r.nome}">\n            <h2>${r.nome}</h2>\n            <p>R$ ${r.preco}</p>\n            <p><strong>Vendedor:</strong> ${r.autor||"Desconhecido"}</p>\n            <button class="buy-btn" onclick="comprar('${r.whatsapp}', '${r.nome}')">Comprar</button>\n            <div class="comentarios" id="comentarios-${t}"></div>\n            <textarea id="comentario-${t}" placeholder="Escreva um comentário..."></textarea>\n            <button onclick="comentar('${t}')">Comentar</button>\n            ${["admin","Admin"].includes(currentUserCargo)?`\n              <button onclick="editarProduto('${t}')">Editar</button>\n              <button onclick="removerProduto('${t}')">Remover</button>\n            `:""}\n          `,e.appendChild(a),carregarComentarios(t)}))}))}function carregarComentarios(e){const o=document.getElementById(`comentarios-${e}`);onValue(ref(db,`comentarios/${e}`),(t=>{o.innerHTML="",t.forEach((t=>{const r=t.key,a=t.val(),n=document.createElement("div");n.innerHTML=`<strong>${a.nome}</strong> [${a.cargo}]: ${a.texto}`,a.uid===currentUser?.uid&&(n.innerHTML+=` <button onclick="removerComentario('${e}', '${r}')">X</button>`),["admin","Admin"].includes(currentUserCargo)&&"usuário"===a.cargo.toLowerCase()&&(n.innerHTML+=` <button onclick="removerComentario('${e}', '${r}')">Remover</button>`,n.innerHTML+=` <button onclick="banirUsuario('${a.uid}')">Banir</button>`),o.appendChild(n)}))}))}function mostrarPoput(e,o){const t=document.createElement("div");t.className="popup",t.innerText=`${e} comprou ${o}`,document.getElementById("popup-container").appendChild(t),setTimeout((()=>t.remove()),5e3)}window.register=async()=>{const e=document.getElementById("registerEmail").value,o=document.getElementById("registerPassword").value,t=document.getElementById("registerUsername").value;if(!e||!o||!t)return alert("Preencha todos os campos.");try{const r=(await createUserWithEmailAndPassword(auth,e,o)).user;await set(ref(db,"users/"+r.uid),{email:e,nome:t,cargo:"usuário",banido:!1}),alert("Cadastro realizado com sucesso!"),showLogin()}catch(e){alert("Erro no cadastro: "+e.message)}},window.login=async()=>{const e=document.getElementById("loginEmail").value,o=document.getElementById("loginPassword").value;try{let t=e;if(!e.includes("@")){(await get(ref(db,"users"))).forEach((o=>{const r=o.val();r.nome===e&&(t=r.email)}))}const r=await signInWithEmailAndPassword(auth,t,o);currentUser=r.user;const a=(await get(ref(db,"users/"+currentUser.uid))).val();if(a.banido)return alert("Você está banido."),await signOut(auth),location.reload();if(currentUserCargo=a.cargo||"usuário",document.getElementById("auth").style.display="none",document.getElementById("shop").style.display="block",document.getElementById("perfilEmail").value=currentUser.email,["admin","Admin"].includes(currentUserCargo)){const e=document.createElement("button");e.textContent="Adicionar Produto",e.className="buy-btn",e.onclick=adicionarProduto,document.querySelector("header").appendChild(e)}carregarProdutos()}catch(e){alert("Erro no login: "+e.message)}},window.logout=async()=>{await signOut(auth),location.reload()},window.showRegister=()=>{document.getElementById("loginBox").style.display="none",document.getElementById("registerBox").style.display="block"},window.showLogin=()=>{document.getElementById("registerBox").style.display="none",document.getElementById("loginBox").style.display="block"},window.togglePerfil=()=>{document.getElementById("perfil").style.display="block",document.getElementById("shop").style.display="none"},window.salvarPerfil=async()=>{const e=document.getElementById("perfilSenha").value,o=document.getElementById("perfilNome").value;o&&await update(ref(db,"users/"+currentUser.uid),{nome:o}),e&&await updatePassword(currentUser,e),alert("Perfil atualizado!")},window.comentar=async e=>{const o=document.getElementById(`comentario-${e}`).value;if(!o)return;const t=(await get(ref(db,"users/"+currentUser.uid))).val(),r=t.nome||t.email,a=t.cargo||"usuário",n=Date.now().toString();await set(ref(db,`comentarios/${e}/${n}`),{uid:currentUser.uid,texto:o,nome:r,cargo:a}),document.getElementById(`comentario-${e}`).value=""},window.removerComentario=async(e,o)=>{await remove(ref(db,`comentarios/${e}/${o}`))},window.banirUsuario=async e=>{await update(ref(db,"users/"+e),{banido:!0}),alert("Usuário banido com sucesso.")},window.adicionarProduto=async()=>{const e=prompt("Nome do produto:"),o=prompt("Preço:"),t=prompt("URL da imagem:"),r=prompt("Link do WhatsApp (ex: https://wa.me/55...)");if(!(e&&o&&t&&r))return alert("Todos os campos são obrigatórios.");const a=(await get(ref(db,"users/"+currentUser.uid))).val(),n=a.nome||a.email,i=Date.now();await set(ref(db,"produtos/"+i),{nome:e,preco:o,imagem:t,whatsapp:r,autor:n}),alert("Produto adicionado!")},window.removerProduto=async e=>{confirm("Tem certeza que deseja remover este produto?")&&(await remove(ref(db,"produtos/"+e)),alert("Produto removido."))},window.editarProduto=async e=>{const o=await get(ref(db,"produtos/"+e));if(!o.exists())return alert("Produto não encontrado.");const t=o.val(),r=prompt("Novo nome do produto:",t.nome),a=prompt("Novo preço:",t.preco),n=prompt("Nova URL da imagem:",t.imagem),i=prompt("Novo link do WhatsApp:",t.whatsapp);if(!(r&&a&&n&&i))return alert("Todos os campos são obrigatórios.");await update(ref(db,"produtos/"+e),{nome:r,preco:a,imagem:n,whatsapp:i}),alert("Produto atualizado!")},window.comprar=(e,o)=>{if(!e)return alert("Este produto não possui link do WhatsApp.");const t=`${e}?text=${encodeURIComponent(`Olá! Tenho interesse em comprar o ${o}.`)}`;window.open(t,"_blank")},onValue(ref(db,"poputs"),(e=>{e.forEach((e=>{const o=e.val();o.ativo&&mostrarPoput(o.usuario,o.produto)}))}))</script>
<style>body{background:#121212;color:#fff;font-family:Arial;margin:0;padding:0}header{background-color:red;color:#fff;padding:20px;text-align:center;font-size:24px;font-weight:700}.container{display:flex;flex-wrap:wrap;justify-content:center;padding:20px}.product{background:#1e1e1e;border:2px solid red;border-radius:10px;margin:15px;padding:20px;width:250px;text-align:center}.product img{max-width:100%;border-radius:8px}.product h2{font-size:20px;margin:10px 0;color:#ff4d4d}.product p{color:#ccc}.buy-btn{background:red;color:#fff;border:none;padding:10px;border-radius:5px;margin-top:10px;cursor:pointer}.auth-container{display:flex;justify-content:center;align-items:center;height:100vh}.auth-box{background:#1e1e1e;padding:30px;border-radius:10px;border:2px solid red;width:300px;text-align:center}.auth-box button,.auth-box input{width:90%;padding:10px;margin:10px 0;border-radius:5px;border:none}.auth-box button{background:red;color:#fff;cursor:pointer}.auth-box a{color:#ff4d4d;cursor:pointer;display:block;margin-top:10px}textarea{width:100%;margin-top:10px;padding:8px;border-radius:5px}.comentarios{text-align:left;margin-top:10px;font-size:14px}.popup{background:red;color:#fff;padding:10px;margin:10px;border-radius:8px;animation:fadeout 1s ease 4s forwards}#popup-container{position:fixed;bottom:10px;left:10px;z-index:9999}@keyframes fadeout{to{opacity:0;transform:translateX(-100%)}}</style>
</head>
<body>
<div id=auth class=auth-container>
<div class=auth-box id=loginBox>
<h2>Login</h2>
<input id=loginEmail placeholder="Email ou Nome de usuário" required>
<input type=password id=loginPassword placeholder=Senha required>
<button onclick=login()>Entrar</button>
<a onclick=showRegister()>Não tem conta? Cadastre-se</a>
</div>
<div class=auth-box id=registerBox style=display:none>
<h2>Cadastro</h2>
<input id=registerUsername placeholder="Nome de usuário" required>
<input type=email id=registerEmail placeholder=Email required>
<input type=password id=registerPassword placeholder=Senha required>
<button onclick=register()>Cadastrar</button>
<a onclick=showLogin()>Já tem conta? Entrar</a>
</div>
</div>
<div id=shop style=display:none>
<header>
NmTeam - Menu
<button onclick=togglePerfil()>Perfil</button>
<button onclick=logout()>Sair</button>
</header>
<div class=container id=produtosContainer>Carregando produtos...</div>
</div>
<div id=perfil class=auth-box style="display:none;margin:20px auto">
<h2>Perfil</h2>
<input id=perfilNome placeholder="Novo nome de usuário">
<input type=password id=perfilSenha placeholder="Nova senha">
<input type=email id=perfilEmail disabled>
<button onclick=salvarPerfil()>Salvar alterações</button>
<button>Voltar</button>
</div>
<div id=popup-container></div>
</body>
</html>
