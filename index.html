<!doctype html>
<html lang=pt-BR>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>NmTeam - Menu</title>
<script type=module>import{initializeApp}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,updatePassword,signOut}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";import{getDatabase,ref,set,onValue,update,remove,get}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";const firebaseConfig={apiKey:"AIzaSyCzj4sP6TvIg1kFAAZ3hrgy9KqAWkDCnx4",authDomain:"skotvidero.firebaseapp.com",databaseURL:"https://skotvidero-default-rtdb.firebaseio.com",projectId:"skotvidero",storageBucket:"skotvidero.appspot.com",messagingSenderId:"797827317952",appId:"1:797827317952:android:83ec9bb10d5a283826ed25"},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getDatabase(app);let currentUser=null,currentUserCargo="";function isDev(){return"dev"===currentUserCargo.toLowerCase()}function carregarProdutos(){const e=document.getElementById("produtosContainer");onValue(ref(db,"produtos"),(t=>{e.innerHTML="",t.forEach((t=>{const o=t.key,r=t.val(),n=document.createElement("div");n.className="product"+("Dev"===r.autorCargo?" dev-produto":""),n.innerHTML=`\n            <img src="${r.imagem}" alt="${r.nome}">\n            <h2>${r.nome}</h2>\n            <p>R$ ${r.preco}</p>\n            <p><strong>Vendedor:</strong> ${r.autor||"Desconhecido"}</p>\n            <button class="buy-btn" onclick="comprar('${r.whatsapp}', '${r.nome}')">Comprar</button>\n            <div class="comentarios" id="comentarios-${o}"></div>\n            <textarea id="comentario-${o}" placeholder="Escreva um comentário..."></textarea>\n            <button onclick="comentar('${o}')">Comentar</button>\n            ${isDev()||["admin","Admin"].includes(currentUserCargo)&&r.autor===currentUser.email?`<button onclick="editarProduto('${o}')">Editar</button>\n                   <button onclick="removerProduto('${o}')">Remover</button>`:""}\n          `,e.appendChild(n),carregarComentarios(o)}))}))}function carregarComentarios(e){const t=document.getElementById(`comentarios-${e}`);onValue(ref(db,`comentarios/${e}`),(o=>{t.innerHTML="",o.forEach((o=>{const r=o.key,n=o.val(),a=document.createElement("div");"dev"===n.cargo.toLowerCase()&&(a.className="comentario-dev"),a.innerHTML=`<strong>${n.nome}</strong> [${n.cargo}]: ${n.texto}`,(isDev()||n.uid===currentUser?.uid||["admin","Admin"].includes(currentUserCargo)&&["usuário","cliente"].includes(n.cargo.toLowerCase()))&&(a.innerHTML+=` <button onclick="removerComentario('${e}', '${r}')">Remover</button>`),(isDev()||["admin","Admin"].includes(currentUserCargo)&&["usuário","cliente"].includes(n.cargo.toLowerCase()))&&(a.innerHTML+=` <button onclick="banirUsuario('${n.uid}')">Banir</button>`),t.appendChild(a)}))}))}function mostrarPoput(e,t){const o=document.createElement("div");o.className="popup",o.innerText=`${e} comprou ${t}`,document.getElementById("popup-container").appendChild(o),setTimeout((()=>o.remove()),5e3)}function carregarChatsRecebidos(){const e=document.getElementById("helperContainer");e.innerHTML="<h2>Mensagens Recebidas</h2>",get(ref(db,"chats")).then((t=>{t.forEach((t=>{t.key;const o=t.val();if(o.participantes&&o.participantes[currentUser.uid]){const t=Object.keys(o.participantes).find((e=>e!==currentUser.uid));get(ref(db,"users/"+t)).then((o=>{const r=o.val(),n=document.createElement("div");n.className="helper-card",n.innerHTML=`\n            <strong>${r?.nome||t}</strong><br/>\n            <button onclick="abrirChatComDev('${t}', '${r?.nome||t}')" style="color:cyan;">Abrir Conversa</button>\n          `,e.appendChild(n)}))}}))}))}function carregarDevs(){const e=document.getElementById("helperContainer");e.innerHTML="<h2>Desenvolvedores</h2>",get(ref(db,"users")).then((t=>{t.forEach((t=>{const o=t.val();if("dev"===o.cargo?.toLowerCase()){const r=document.createElement("div");r.className="helper-card",r.innerHTML=`\n          <strong>${o.nome}</strong><br/>\n          <button onclick="abrirChatComDev('${t.key}', '${o.nome}')" style="color:cyan;">Chat</button>\n        `,e.appendChild(r)}}))}))}window.register=async()=>{const e=document.getElementById("registerEmail").value,t=document.getElementById("registerPassword").value,o=document.getElementById("registerUsername").value;if(!e||!t||!o)return alert("Preencha todos os campos.");try{const r=(await createUserWithEmailAndPassword(auth,e,t)).user;await set(ref(db,"users/"+r.uid),{email:e,nome:o,cargo:"usuário",banido:!1}),alert("Cadastro realizado com sucesso!"),showLogin()}catch(e){alert("Erro no cadastro: "+e.message)}},window.login=async()=>{const e=document.getElementById("loginEmail").value,t=document.getElementById("loginPassword").value;try{let o=e;e.includes("@")||(await get(ref(db,"users"))).forEach((t=>{const r=t.val();r.nome===e&&(o=r.email)}));const r=await signInWithEmailAndPassword(auth,o,t);currentUser=r.user;const n=(await get(ref(db,"users/"+currentUser.uid))).val();if(n.banido)return alert("Você está banido."),await signOut(auth),location.reload();if(currentUserCargo=n.cargo||"usuário",document.getElementById("auth").style.display="none",document.getElementById("shop").style.display="block",document.getElementById("perfilEmail").value=currentUser.email,document.getElementById("perfilLink").value=n.link||"",["admin","Admin","DEV","dev","Dev"].includes(currentUserCargo)){const e=document.createElement("button");e.innerHTML="➕",e.className="floating-add",e.onclick=adicionarProduto,document.querySelector("header").appendChild(e)}carregarProdutos()}catch(e){alert("Erro no login: "+e.message)}},window.logout=async()=>{await signOut(auth),location.reload()},window.showRegister=()=>{document.getElementById("loginBox").style.display="none",document.getElementById("registerBox").style.display="block"},window.showLogin=()=>{document.getElementById("registerBox").style.display="none",document.getElementById("loginBox").style.display="block"},window.togglePerfil=()=>{document.getElementById("perfil").style.display="block",document.getElementById("shop").style.display="none"},window.salvarPerfil=async()=>{const e=document.getElementById("perfilSenha").value,t=document.getElementById("perfilNome").value;t&&await update(ref(db,"users/"+currentUser.uid),{nome:t});const o=document.getElementById("perfilLink").value;o&&await update(ref(db,"users/"+currentUser.uid),{link:o}),e&&await updatePassword(currentUser,e),alert("Perfil atualizado!")},window.comentar=async e=>{const t=document.getElementById(`comentario-${e}`).value;if(!t)return;const o=(await get(ref(db,"users/"+currentUser.uid))).val(),r=o.nome||o.email,n=o.cargo||"usuário",a=Date.now().toString();await set(ref(db,`comentarios/${e}/${a}`),{uid:currentUser.uid,texto:t,nome:r,cargo:n}),document.getElementById(`comentario-${e}`).value=""},window.removerComentario=async(e,t)=>{await remove(ref(db,`comentarios/${e}/${t}`))},window.banirUsuario=async e=>{await update(ref(db,"users/"+e),{banido:!0}),alert("Usuário banido com sucesso.")},window.adicionarProduto=async()=>{const e=prompt("Nome do produto:"),t=prompt("Preço:"),o=prompt("URL da imagem:"),r=prompt("Link do WhatsApp (ex: https://wa.me/55...)");if(!(e&&t&&o&&r))return alert("Todos os campos são obrigatórios.");const n=(await get(ref(db,"users/"+currentUser.uid))).val(),a=n.nome||n.email,s=n.cargo||"usuário",i=Date.now();await set(ref(db,"produtos/"+i),{nome:e,preco:t,imagem:o,whatsapp:r,autor:a,autorCargo:s}),alert("Produto adicionado!")},window.removerProduto=async e=>{confirm("Tem certeza que deseja remover este produto?")&&(await remove(ref(db,"produtos/"+e)),alert("Produto removido."))},window.editarProduto=async e=>{const t=await get(ref(db,"produtos/"+e));if(!t.exists())return alert("Produto não encontrado.");const o=t.val(),r=prompt("Novo nome do produto:",o.nome),n=prompt("Novo preço:",o.preco),a=prompt("Nova URL da imagem:",o.imagem),s=prompt("Novo link do WhatsApp:",o.whatsapp);if(!(r&&n&&a&&s))return alert("Todos os campos são obrigatórios.");await update(ref(db,"produtos/"+e),{nome:r,preco:n,imagem:a,whatsapp:s}),alert("Produto atualizado!")},window.comprar=(e,t)=>{if(!e)return alert("Este produto não possui link do WhatsApp.");const o=`${e}?text=${encodeURIComponent(`Olá! Tenho interesse em comprar o ${t}.`)}`;window.open(o,"_blank")},window.mostrarAba=e=>{const t=document.getElementById("produtosContainer"),o=document.getElementById("helperContainer");document.querySelectorAll(".tabs button").forEach((e=>e.classList.remove("active"))),"compras"===e?(t.style.display="grid",o.style.display="none",document.getElementById("comprasTab").classList.add("active")):(t.style.display="none",o.style.display="block","dev"===currentUserCargo.toLowerCase()?carregarChatsRecebidos():carregarDevs(),document.querySelector(".tabs button:nth-child(2)").classList.add("active"))},onValue(ref(db,"poputs"),(e=>{e.forEach((e=>{const t=e.val();t.ativo&&mostrarPoput(t.usuario,t.produto)}))})),window.abrirChatComDev=async(e,t)=>{const o=[currentUser.uid,e].sort().join("-"),r=ref(db,`chats/${o}`);(await get(r)).exists()||await set(ref(db,`chats/${o}/participantes`),{[currentUser.uid]:!0,[e]:!0}),mostrarChat(o,t)},window.mostrarChat=(e,t)=>{let o=document.getElementById("chatContainer");o||(o=document.createElement("div"),o.id="chatContainer",o.style.background="#1e1e1e",o.style.padding="20px",o.style.margin="20px",o.style.border="1px solid #444",o.style.borderRadius="10px",o.style.color="white",document.body.appendChild(o)),o.innerHTML=`<h3>Chat com ${t}</h3>\n        <div id="mensagens"></div>\n        <textarea id="mensagemInput" placeholder="Digite sua mensagem..."></textarea>\n        <button onclick="enviarMensagem('${e}')">Enviar</button>\n        <button onclick="fecharChat()">Fechar</button>`,o.style.display="block";const r=document.getElementById("mensagens");onValue(ref(db,`chats/${e}/mensagens`),(e=>{r.innerHTML="",e.forEach((e=>{const t=e.val();r.innerHTML+=`<p><strong>${t.autor}:</strong> ${t.texto}</p>`}))}))},window.enviarMensagem=e=>{const t=document.getElementById("mensagemInput").value;if(!t)return;const o=Date.now();set(ref(db,`chats/${e}/mensagens/${o}`),{autor:currentUser.email,uid:currentUser.uid,texto:t}),document.getElementById("mensagemInput").value=""},window.fecharChat=()=>{const e=document.getElementById("chatContainer");e&&(e.style.display="none")}</script>
<style>body{background:#121212;color:#fff;font-family:Arial;margin:0;padding:0}header{background-color:red;color:#fff;padding:20px;text-align:center;font-size:24px;font-weight:700}.container{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;justify-items:center;padding:20px;max-width:600px;margin:0 auto}.product{background:#1e1e1e;border:2px solid red;border-radius:10px;padding:10px;width:100%;max-width:250px;text-align:center;box-sizing:border-box}.product img{max-width:100%;border-radius:8px}.product h2{font-size:20px;margin:10px 0;color:#ff4d4d}.product p{color:#ccc}.buy-btn{background:red;color:#fff;border:none;padding:10px;border-radius:5px;margin-top:10px;cursor:pointer}.auth-container{display:flex;justify-content:center;align-items:center;height:100vh}.auth-box{background:#1e1e1e;padding:30px;border-radius:10px;border:2px solid red;width:300px;text-align:center}.auth-box button,.auth-box input{width:90%;padding:10px;margin:10px 0;border-radius:5px;border:none}.auth-box button{background:red;color:#fff;cursor:pointer}.auth-box a{color:#ff4d4d;cursor:pointer;display:block;margin-top:10px}textarea{width:100%;margin-top:10px;padding:8px;border-radius:5px}.comentarios{text-align:left;margin-top:10px;font-size:14px}.popup{background:red;color:#fff;padding:10px;margin:10px;border-radius:8px;animation:fadeout 1s ease 4s forwards}#popup-container{position:fixed;bottom:10px;left:10px;z-index:9999}@keyframes fadeout{to{opacity:0;transform:translateX(-100%)}}.comentario-dev{border-left:4px solid #0ff;padding-left:6px;background-color:#1a1a1a;font-weight:700;color:#0ff}.product.dev-produto{border-color:#0ff;box-shadow:0 0 10px #00ffff88}header{background-color:red;color:#fff;padding:8px 10px;display:flex;align-items:center;justify-content:space-between;font-size:16px;font-weight:700}header button{margin-left:8px;padding:5px 10px;border-radius:5px;border:none}header button#perfilBtn{background:0 0;color:#fff;font-size:18px}header button#logoutBtn{background:red;color:#fff;box-shadow:0 0 8px #fff}.tabs{display:flex;justify-content:center;background:#1a1a1a;padding:5px;gap:10px}.tabs button{background:#333;border:none;padding:8px 12px;color:#fff;cursor:pointer;border-radius:5px}.tabs button.active{background:red}#helperContainer{display:none;padding:15px}.helper-card{background:#1e1e1e;border:1px solid #0ff;border-radius:8px;padding:10px;margin-bottom:10px}.floating-add{position:fixed;bottom:20px;right:20px;background:red;color:#fff;border:none;border-radius:50%;width:50px;height:50px;font-size:28px;line-height:50px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,.3);cursor:pointer;z-index:1000}.copyright-footer{position:fixed;bottom:0;width:100%;text-align:center;padding:10px 0;background:#1a1a1a;color:#aaa;font-size:14px;z-index:999}</style>
</head>
<body>
<div id=auth class=auth-container>
<div class=auth-box id=loginBox>
<h2>Login</h2>
<input id=loginEmail placeholder="Email ou Nome de usuário" required>
<input type=password id=loginPassword placeholder=Senha required>
<button onclick=login()>Entrar</button>
<a onclick=showRegister()>Não tem conta? Cadastre-se</a>
</div>
<div class=auth-box id=registerBox style=display:none>
<h2>Cadastro</h2>
<input id=registerUsername placeholder="Nome de usuário" required>
<input type=email id=registerEmail placeholder=Email required>
<input type=password id=registerPassword placeholder=Senha required>
<button onclick=register()>Cadastrar</button>
<a onclick=showLogin()>Já tem conta? Entrar</a>
</div>
</div>
<div id=shop style=display:none>
<header>
<span>NmTeam - Menu</span>
<div>
<button id=perfilBtn onclick=togglePerfil()>⚙️</button>
</div>
</header>
<div class=tabs>
<button id=comprasTab class=active onclick='mostrarAba("compras")'>Lojinha</button>
<button onclick='mostrarAba("helper")'>Suport</button>
</div>
<div class=container id=produtosContainer>Carregando produtos...</div>
<div id=helperContainer></div>
</div>
<div id=perfil class=auth-box style="display:none;margin:20px auto">
<h2>Perfil</h2>
<input id=perfilNome placeholder="Novo nome de usuário">
<input type=password id=perfilSenha placeholder="Nova senha">
<input type=email id=perfilEmail disabled>
<input type=url id=perfilLink placeholder="Link de contato (usar para publicar um produto)">
<button onclick=salvarPerfil()>Salvar alterações</button>
<button>Voltar</button>
</div>
<div id=popup-container></div>
<footer class=copyright-footer>© 2025 NmTeam. Todos os direitos reservados.</footer>
</body>
</html>
